<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- EJ2 Document Editor dependent theme -->
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-base/styles/material.css" rel="stylesheet" type="text/css"
        rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-buttons/styles/material.css" rel="stylesheet" type="text/css"
        rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-inputs/styles/material.css" rel="stylesheet" type="text/css"
        rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-popups/styles/material.css" rel="stylesheet" type="text/css"
        rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-lists/styles/material.css" rel="stylesheet" type="text/css"
        rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-navigations/styles/material.css" rel="stylesheet"
        type="text/css" rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-splitbuttons/styles/material.css" rel="stylesheet"
        type="text/css" rel='nofollow' />
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-dropdowns/styles/material.css" rel="stylesheet"
        type="text/css" rel='nofollow' />

    <!-- EJ2 Document Editor theme -->
    <link href="https://cdn.syncfusion.com/ej2/28.1.39/ej2-documenteditor/styles/material.css" rel="stylesheet"
        type="text/css" rel='nofollow' />

    <script src="https://cdn.syncfusion.com/ej2/28.1.39/dist/ej2.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body {
            margin: 0px;
        }
    </style>
</head>

<body>
    <div>
        <div id="toast_type"></div>
        <div style="height: 93vh;">
            <div id='documenteditor_titlebar' class="e-de-ctn-title"></div>
            <div id="documenteditor"></div>
        </div>
        <div id="defaultDialog" style="display: none;">
            <div class="e-de-para-dlg-heading">
                Share this URL with others for real-time editing
            </div>
            <div class="e-de-container-row">
                <input type="text" id="share_url" class="e-input" readonly />
            </div>
        </div>
    </div>
    <style>
        .e-de-share::before {
            content: "\e7b9";
            font-family: 'e-icons';
        }

        .e-tooltip-menu-settings.e-tooltip-wrap.e-popup {
            background: white;
            border-radius: 0px;
            border: none;
        }

        .e-tooltip-menu-settings.e-tooltip-wrap.e-popup .collab-user-info {
            font-size: 12px;
            margin-left: 10px;
        }

        #documenteditor_titlebar {
            height: 36px;
            line-height: 26px;
            /* width: 100%; */
            font-size: 12px;
            padding-left: 15px;
            padding-right: 10px;
            /* font-family: inherit; */
        }

        #documenteditor_title_contentEditor {
            height: 26px;
            max-width: 85%;
            width: auto;
            overflow: hidden;
            display: inline-block;
            padding-left: 4px;
            padding-right: 4px;
            margin: 5px;
        }

        .single-line {
            cursor: text !important;
            outline: none;
        }

        .single-line:hover {
            border-color: #e4e4e4 !important;
        }

        [contenteditable="true"].single-line {
            white-space: nowrap;
            border-color: #e4e4e4 !important;
        }

        [contenteditable="true"].single-line * {
            white-space: nowrap;
        }

        /** Document editor sample level font icons*/

        @font-face {
            font-family: 'Toast_icons';
            src: url(data:application/x-font-ttf;charset=utf-8;base64,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) format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        .toast-icons {
            font-family: 'Toast_icons' !important;
            speak: none;
            font-size: 55px;
            font-style: normal;
            font-weight: normal;
            font-variant: normal;
            text-transform: none;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .toast-icons.e-success::before {
            content: "\e701";
        }

        .toast-icons.e-error::before {
            content: "\e700";
        }

        /** sample level font icons ends*/
    </style>

    <script>

        //Collaborative editing controller url

        let serviceUrl = 'http://localhost:8098/';
        var connectionId = "";
        const toolbarItems = ['Undo', 'Redo', 'Separator', 'Image', 'Table', 'Hyperlink', 'Bookmark', 'TableOfContents', 'Separator', 'Header', 'Footer', 'PageSetup', 'PageNumber', 'Break', 'InsertFootnote', 'InsertEndnote', 'Separator', 'Find', 'Separator', 'Comments', 'TrackChanges', 'Separator', 'LocalClipboard', 'RestrictEditing', 'Separator', 'FormFields', 'UpdateFields']
        const users = ["Kathryn Fuller", "Tamer Fuller", "Martin Nancy", "Davolio Leverling", "Nancy Fuller", "Fuller Margaret", "Leverling Andrew"];

        const random = Math.floor(Math.random() * users.length);
        var currentUser = users[random]
        var currentRoomName = '';
        var webSocketEndPoint = 'http://localhost:8098/ws';
        var stompClient;

        /**
         * Container component
         */
        var container = new ej.documenteditor.DocumentEditorContainer({ height: "100%", toolbarItems: toolbarItems, enableToolbar: true, currentUser: currentUser });
        container.serviceUrl = serviceUrl + 'api/wordeditor/';
        ej.documenteditor.DocumentEditorContainer.Inject(ej.documenteditor.Toolbar);
        container.appendTo('#documenteditor');

        //Injecting collaborative editing module
        ej.documenteditor.DocumentEditor.Inject(ej.documenteditor.CollaborativeEditingHandler);
        //Enable collaborative editing in DocumentEditor
        container.documentEditor.enableCollaborativeEditing = true;

        container.contentChange = function (args) {
            if (container.documentEditor.collaborativeEditingHandlerModule) {
                container.documentEditor.collaborativeEditingHandlerModule.sendActionToServer(args.operations);
            }
        };

        window.addEventListener('resize', function (e) {
            setTimeout(() => {
                container.resize();
            }, 0);
        });

        function initializeSockJs() {
            let ws = new SockJS(webSocketEndPoint);
            stompClient = Stomp.over(ws);
            stompClient.connect({}, () => {
                onConnected();
            }, (error) => {
                console.error('Error during WebSocket connection', error);
            });
        }

        function onConnected() {
            if (stompClient.connected) {
                // Subscribe to the specific topic            
                stompClient.subscribe('/topic/public/' + currentRoomName, onDataRecived);
                connectToRoom(currentRoomName);
                console.log('server connected!!!');
            } else {
                console.log('Waiting for WebSocket connection...');
            }
        }

        //Method to process the data received from server
        function onDataRecived(data) {
            if (container.documentEditor.collaborativeEditingHandlerModule) {
                var content = JSON.parse(data.body);
                var action = content.headers['action'];
                //debugger;

                if (content.payload.operations != null) {
                    container.documentEditor.collaborativeEditingHandlerModule.applyRemoteAction("action", content.payload);
                }
                else if (action == "removeUser") {
                    container.documentEditor.collaborativeEditingHandlerModule.applyRemoteAction("removeUser", content.payload.connectionId);
                    titleBar.updateUserInfo(content.payload.connectionId, 'removeUser');
                } else if (action == "connectionId" && connectionId == "") {
                    connectionId = content.payload.connectionId;
                    container.documentEditor.collaborativeEditingHandlerModule.applyRemoteAction("connectionId", content.payload.connectionId);
                }
                else if (Array.isArray(content.payload)) {
                    titleBar.updateUserInfo(content.payload, 'addUser');
                }
            }
        }

        function connectToRoom() {
            var userInfo = {
                currentUser: container.currentUser,
                clientVersion: 0,
                roomName: currentRoomName,
                connectionId: "",
            };
            //Send the user information to server
            stompClient.send("/app/join/" + currentRoomName, {}, JSON.stringify(userInfo));
        };

        function openDocument(responseText, roomName) {


            var data = responseText;

            //Update the room and version information to collaborative editing handler.
            container.documentEditor.collaborativeEditingHandlerModule.updateRoomInfo(roomName, 0, serviceUrl + 'api/collaborativeediting/');

            //Open the document
            container.documentEditor.open(data);

            container.documentEditor.documentName = "Giant Panda";
            setTimeout(function () {
                // connect to server using signalR
                //connectToRoom({ action: 'connect', roomName: roomName, currentUser: container.currentUser });
            });

            ej.popups.hideSpinner(document.body);
            titleBar.updateDocumentTitle();
        }

        function loadDocumentFromServer() {
            //debugger;
            ej.popups.showSpinner(document.body);
            var queryString = window.location.search;
            var urlParams = new URLSearchParams(queryString);
            //Get the room id from the query string
            var roomId = urlParams.get('fileName');

            if (roomId == null) {
                // If room id is not available, generate a new room id
                // This random is used for demo purpose only. In real-time scenario, you need to generate a unique room id for each document and maintain it in the server and 
                // reuse it when the user reopens the document.
                roomId = Math.random().toString(32).slice(2)
                window.history.replaceState({}, "", `?fileName=` + roomId);
            }
            currentRoomName = roomId;
            var httpRequest = new XMLHttpRequest();
            httpRequest.open('Post', serviceUrl + 'api/collaborativeediting/ImportFile', true);
            httpRequest.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState === 4) {
                    if (httpRequest.status === 200 || httpRequest.status === 304) {
                        openDocument(httpRequest.responseText, roomId);
                    } else {
                        ej.popups.hideSpinner(document.body);
                        alert('Fail to load the document');
                    }
                }
            };
            httpRequest.send(JSON.stringify({ "fileName": "Giant Panda.docx", "roomName": roomId }));
        }

        ej.popups.createSpinner({
            target: document.body
        });

        initializeSockJs();
        loadDocumentFromServer();

        // title bar
        var TitleBar = function () {
            function TitleBar(element, docEditor, isShareNeeded, isRtl) {
                var _this = this;
                this.userMap = {};
                this.initializeTitleBar = function (isShareNeeded) {
                    var shareText;
                    var shareToolTip;
                    var documentTileText;
                    if (!_this.isRtl) {
                        shareText = 'Share';
                        shareToolTip = 'Share this link';
                    }
                    _this.documentTitle = ej.base.createElement('label', { id: 'documenteditor_title_name', className: "e-control", styles: 'font-weight:400;text-overflow:ellipsis;white-space:pre;overflow:hidden;user-select:none;cursor:text;font-size:14px' });
                    var iconCss = 'e-de-padding-right';
                    var btnFloatStyle = 'float:right;';
                    var titleCss = '';
                    _this.documentTitleContentEditor = ej.base.createElement('div', { id: 'documenteditor_title_contentEditor', className: 'single-line', styles: titleCss });
                    _this.documentTitleContentEditor.appendChild(_this.documentTitle);
                    _this.tileBarDiv.appendChild(_this.documentTitleContentEditor);
                    _this.documentTitleContentEditor.setAttribute('title', documentTileText);
                    var btnStyles = btnFloatStyle + 'background: transparent;box-shadow:none;border-color: transparent;'
                        + 'border-radius: 2px;color:inherit;font-size:12px;text-transform:capitalize;height:28px;font-weight:400;margin-top: 2px;';
                    _this.print = _this.addButton(iconCss, shareText, btnStyles, 'de-print', shareToolTip, false);
                    _this.userList = ej.base.createElement('div', { id: 'de_userInfo', styles: 'float:right;margin-top: 3px;' });
                    _this.tileBarDiv.appendChild(_this.userList);
                };
                this.wireEvents = function () {
                    _this.print.element.addEventListener('click', _this.shareUrl);
                };
                this.shareUrl = function () {
                    dialogObj.show();
                },
                    this.updateDocumentTitle = function () {
                        if (_this.documentEditor.documentName === '') {
                            _this.documentEditor.documentName = 'Untitled';
                        }
                        _this.documentTitle.textContent = _this.documentEditor.documentName;
                    };
                this.onPrint = function () {
                    _this.documentEditor.print();
                };
                this.tileBarDiv = element;
                this.documentEditor = docEditor;
                this.isRtl = isRtl;
                this.initializeTitleBar(isShareNeeded);
                this.wireEvents();

            }
            TitleBar.prototype.addButton = function (iconClass, btnText, styles, id, tooltipText, isDropDown, items) {
                var button = ej.base.createElement('button', { id: id, styles: styles });
                this.tileBarDiv.appendChild(button);
                button.setAttribute('title', tooltipText);
                var ejButton = new ej.buttons.Button({ content: btnText, iconCss: 'e-de-share' }, button);
                return ejButton;
            };
            TitleBar.prototype.updateUserInfo = function (actionInfos, type) {
                if (!(actionInfos instanceof Array)) {
                    actionInfos = [actionInfos];
                }
                if (type == "removeUser") {
                    if (this.userMap[actionInfos]) {
                        delete this.userMap[actionInfos];
                    }
                } else {
                    for (var i = 0; i < actionInfos.length; i++) {
                        this.userMap[actionInfos[i].connectionId] = actionInfos[i];
                    }
                }
                this.userList.innerHTML = "";
                let keys = Object.keys(this.userMap);
                for (var i = 0; i < keys.length; i++) {
                    var actionInfo = this.userMap[keys[i]];
                    var avatar = ej.base.createElement('div', { className: 'e-avatar e-avatar-xsmall e-avatar-circle', styles: 'margin: 0px 5px', innerHTML: this.constructInitial(actionInfo.currentUser) });
                    avatar.title = actionInfo.currentUser;
                    avatar.style.cursor = 'default';
                    this.userList.appendChild(avatar);
                    if (keys.length > 5 && i == 4) {
                        this.addListView(keys.slice(i + 1));
                        break;
                    }
                }
            };
            TitleBar.prototype.addListView = function (keys) {
                var avatar = ej.base.createElement('div', { className: 'e-avatar e-avatar-xsmall e-avatar-circle', styles: 'margin: 0px 3px', innerHTML: '+' + (keys.length) });
                avatar.style.cursor = 'pointer';
                avatar.tabIndex = 1;
                this.userList.appendChild(avatar);
                var dataSource = [];
                for (var i = 0; i < keys.length; i++) {
                    var actionInfo = this.userMap[keys[i]];
                    dataSource.push({ id: "s_0" + i, text: actionInfo.currentUser, avatar: this.constructInitial(actionInfo.currentUser) });
                }
                var listViewContainer = document.createElement('div');
                var letterAvatarList = new ej.lists.ListView({
                    // Bind listview datasource
                    dataSource: dataSource,
                    // Enable header title
                    showHeader: false,
                    // Assign list-item template
                    template: '<div class="listWrapper">' +
                        '${if(avatar!=="")}' +
                        '<span class="e-avatar e-avatar-xsmall e-avatar-circle">${avatar}</span>' +
                        '${else}' +
                        '<span class="${pic} e-avatar e-avatar-xsmall e-avatar-circle"> </span>' +
                        '${/if}' +
                        '<span class="collab-user-info">' +
                        '${text} </span> </div>',
                    // Assign sorting order
                    sortOrder: 'Ascending'
                });
                letterAvatarList.appendTo(listViewContainer);
                var listViewTooltip = new ej.popups.Tooltip({
                    cssClass: 'e-tooltip-template-css',
                    //Set tooltip open mode
                    opensOn: 'Focus',
                    //Set tooltip content
                    content: listViewContainer,
                    width: "200px",
                    cssClass: 'e-tooltip-menu-settings',
                    showTipPointer: false
                });
                //Render initialized Tooltip component
                listViewTooltip.appendTo(avatar);
            };
            TitleBar.prototype.constructInitial = function (authorName) {
                var splittedName = authorName.split(' ');
                var initials = '';
                for (var i = 0; i < splittedName.length; i++) {
                    if (splittedName[i].length > 0 && splittedName[i] !== '') {
                        initials += splittedName[i][0];
                    }
                }
                return initials;


            };
            return TitleBar;
        }();

        var titleBar = new TitleBar(document.getElementById('documenteditor_titlebar'), container.documentEditor, true);


        var dialogObj = new ej.popups.Dialog({
            header: 'Share ' + container.documentEditor.documentName + '.docx',
            animationSettings: { effect: 'None' },
            showCloseIcon: true,
            isModal: true,
            width: '500px',
            visible: false,
            buttons: [{
                click: dlgButtonClick,
                buttonModel: { id: "copy_button", content: 'Copy URL', isPrimary: true }
            }],
            open: function () {
                document.getElementById("share_url").value = window.location.href;
                document.getElementById("share_url").select();
            },
            beforeOpen: function () {
                dialogObj.header = 'Share "' + container.documentEditor.documentName + '.docx"';
                document.getElementById("defaultDialog").style.display = "block";
            },
        });
        dialogObj.appendTo('#defaultDialog');

        function dlgButtonClick(event) {
            // Get the text field
            var copyText = document.getElementById("share_url");

            // Select the text field
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            // Copy the text inside the text field
            navigator.clipboard.writeText(copyText.value);

            let toastMessage = { title: 'Success!', content: 'Link Copied.', cssClass: 'e-toast-success', icon: 'e-success toast-icons' };
            toastObj.show(toastMessage);
            dialogObj.hide();
        }


        var toastObj = new ej.notifications.Toast({
            position: {
                X: 'Right'
            },
            target: document.body
        });
        toastObj.appendTo('#toast_type');

    </script>

    <!-- 
    <script>
        const urlSearchParams = new URLSearchParams(window.location.search);
        const selectedValue = urlSearchParams.get('fileName');
        var stompClient = null;
        var username = "Akshaya";
        var serviceurl = "http://localhost:8096/api/collaborativeediting/";
        var documentName = "Default.docx";
        var userList;
        var userMap = {};
        var currentConnectionId = '';

        ejs.documenteditor.DocumentEditor.Inject(ejs.documenteditor.CollaborativeEditing)
        ejs.documenteditor.DocumentEditorContainer.Inject(ejs.documenteditor.Toolbar);

        var container = new ejs.documenteditor.DocumentEditorContainer({
            height: "590px", currentUser: username,
            toolbarItems: [
                'Undo', 'Redo',
                'Separator', 'Image', 'Table', 'Hyperlink', 'Bookmark', 'TableOfContents', 'Separator', 'Header', 'Footer', 'PageSetup', 'PageNumber', 'Break', 'InsertFootnote', 'InsertEndnote', 'Separator', 'Find', 'Separator', 'Comments', 'TrackChanges', 'Separator', 'LocalClipboard', 'RestrictEditing', 'Separator', 'FormFields', 'UpdateFields'],
        });
        container.serviceUrl = 'https://hostingjava-g5h6gkgzh3bagzah.eastus-01.azurewebsites.net/api/collaborativeediting/';

        container.appendTo('#container');
        container.documentEditor.enableCollaborativeEditing = true;
        function onCreated(data) {
            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, onConnected, function (error) {
                console.error('Error during WebSocket connection', error);
            });
            
        }

        function joinGroup(documentName) {
            var userInfo = {
                currentUser: username,
                clientVersion: 0,
                roomName: documentName,
                connectionId: "",
            };

            // Send the joinGroup message to the server
            stompClient.send("/app/join/" + documentName, {}, JSON.stringify(userInfo));

        }

        container.contentChange = function (args) {
            if (connections) {
                connections.sendActionToServer(args.operations)
            }
        }

        function onConnected() {
            if (stompClient.connected) {
                // Subscribe to the specific user
                var roomName = documentName;
                stompClient.subscribe('/topic/public/' + documentName, onMessageReceived);
                joinGroup(documentName);
                ejs.popups.hideSpinner(document.getElementById('editor_area'));
                console.log('server connected!!!');
            } else {
                // Handle the case where the connection is not yet established
                console.log('Waiting for WebSocket connection...');
            }
        }
        function handleSubscriptionError(error) {
            console.error('Error during subscription', error);
        }
        function onMessageReceived(data) {
            var content = JSON.parse(data.body);
            var action = content.headers['action'];
            if (content.payload.operations != null) {
                container.documentEditor.collaborativeEditingHandlerModule.applyRemoteAction("action", content.payload);
            }
            else if (action == "removeUser") {
                connections.applyRemoteAction("removeUser", content.payload);
                removeUser(content.payload);
            } else if (action == "connectionId" && currentConnectionId == "") {
                currentConnectionId = content.payload.connectionId;
                connections.applyRemoteAction("connectionId", content.payload.connectionId);

            }
            else if (Array.isArray(content.payload)) {
                for (i = 0; i < content.payload.length; i++) {
                    var conecId = (content.payload)[i].connectionId;
                    if (conecId != currentConnectionId && (!userMap[conecId])) {
                        addUser(content.payload[i]);

                    }
                }
            }
        }


        function onUserDisconnected(data) {
            console.log('User disconnected: ' + data);
        }
        function loadDefaultDocument() {
            documentName = selectedValue;
            ejs.popups.showSpinner(document.getElementById('editor_area'));
            var httpRequest = new XMLHttpRequest();
            httpRequest.open('Post', 'http://localhost:8096/api/collaborativeediting/ImportFile', true);
            httpRequest.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            httpRequest.onreadystatechange = function () {
                if (httpRequest.readyState === 4) {
                    if (httpRequest.status === 200 || httpRequest.status === 304) {
                        connections = container.documentEditor.collaborativeEditingHandlerModule;
                        connections.updateRoomInfo(documentName, 0, serviceurl);
                        container.documentEditor.open(httpRequest.responseText);
                        setTimeout(function () {
                            onCreated(httpRequest.responseText);
                        });
                    }
                    else {
                        ejs.popups.hideSpinner(document.getElementById('editor_area'));
                        alert('Fail to load the document');
                    }
                }
            };
            container.documentEditor.documentName = documentName.substr(0, documentName.lastIndexOf('.'));
            httpRequest.send(JSON.stringify({ "fileName": documentName }));
        }


        function addUser(actionInfos) {
            if (!(actionInfos instanceof Array)) {
                actionInfos = [actionInfos];
            }
            for (var i = 0; i < actionInfos.length; i++) {
                var actionInfo = actionInfos[i];
                if (userMap[actionInfo.connectionId]) {
                    continue;
                }
                userMap[actionInfo.connectionId] = actionInfo;
            }
        }

        function removeUser(actionInfos) {
            if (userMap[actionInfos.connectionId]) {
                delete userMap[actionInfos.connectionId];
            }

        }
        loadDefaultDocument();
    </script> -->
</body>

</html>